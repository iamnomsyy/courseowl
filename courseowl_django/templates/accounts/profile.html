{% extends "base.html" %}
{% block content %}
{% load socialaccount %}

<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
 <link rel="stylesheet" href="stylesheets/stylesheet.css">
<div class="pagination-centered">
<div class="col-md-6 col-sm-6">
            <div class="container">
                 <div class="row vertical-center-row row-md-offset-4">
                  <div class="form">
                     <h2>Welcome </h2>
                     <p><h4><i class="glyphicon glyphicon-user"></i> {{ email }}</h4></p>
<!-- testing for table / topbar / color, akshay-->
    <div class="topbar">
      <div class="fill">
        <div class="container span18">
        </div>
      </div>
    </div>

    <div class="container span18">
      <div class='cleaner_h40'></div>
        <div class='span14'>
          {% if enrolled_list %}
          <h2>Active Courses</h2>
          <table class='table table-striped'>
              <thead>
                  <tr>

                      <th class='span4'>Course</th>
                      <th class='span2'>Provider</th>
                      <th class='span2'>Instructor</th>
                      <th class='span4'>Action</th>
                  </tr>
              </thead>
              <tbody class="enrolled-courses">
              {%for course in enrolled_list %}
                  <tr data-id="{{course.id}}">

                      <td>{{  course.name }}</td>
                      <td>{{ course.provider }}</td>
                      <td>{{  course.instructor }}</td>
                      <td>
                        <div class='btn btn-small btn-info'>Course info</div>
                        <div class='btn btn-small btn-danger pull-right drop-button' data-toggle="drop-modal">
                          Drop course
                        </div>
                      </td>
                  </tr>
              {% endfor %}

              </tbody>
          </table>
        {% else %}
          <h2>It seems you have no active courses</h2>
          <a href="/course_preferences" class="btn btn-success btn-large">Add Courses</a>
        {% endif %}
          <h2>Recommendations</h2>
         <table class='table table-striped'>
              <thead>
                  <tr>

                      <th class='span4'>Course</th>
                      <th class='span2'>Provider</th>
                      <th class='span4'>Instructor</th>
                      <th class='span4'>Action</th>
                  </tr>
              </thead>
              <tbody class="recommended-courses">
              <!-- Check again -->
                {%for course in recommend_list %}
                  <tr data-id="{{ course.id }}">
                      <td>{{course.name}}</td>
                      <td>{{course.provider}}</td>
                      <td>{{course.instructor}}</td>
                      <td>
                        <div class='btn btn-small btn-info'>Course info</div>
                        <div class='btn btn-small btn-success add-course'>Add Course</div>
                      </td>
                  </tr>
                {% endfor %}
              </tbody>
          </table>
        </div><!-- do not modify the tags see zebra-striped , akshay-->
      </div>
    </div></div></div></div></div>
    <div class="row vertical-center-row row-md-offset-4">
            <div class="col-md-4 col-md-offset-4">

        <div class="well span4 sidebar">
            <div class='cleaner_h10'></div>
            <div><a href='/personalize' class='btn btn-success btn-large'>Add more subjects and courses</a></div><br>
        </div><!-- end of sidebar -->
</div></div>

<!-- Drop course confirmation modal -->
<div class="modal fade" id="dropCourse" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="modalLabel">Dropping Course</h4>
      </div>
      <div class="modal-body">
        Are you sure you want to drop this course?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="confirmDrop" type="button" class="btn btn-danger">Yes</button>
      </div>
    </div>
  </div>
</div>

<!-- Change credentials modal -->
<div class="modal fade" id="change-credentials" tabindex="-1" role="dialog" aria-labelledby="cred-modal-label" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="cred-modal-label">Update credentials</h4>
      </div>
      <div class="modal-body">
        <form role="form" id="credentials-form">
          <div class="form-group">
            <label for="credential-email">Email address</label>
            <input type="email" class="form-control" id="credential-email" placeholder="Enter new email">
          </div>
          <div class="form-group">
            <label for="credential-password">Password</label>
            <input type="password" class="form-control" id="credential-password" placeholder="New password">
            <input type="password" class="form-control" id="credential-confirm-password" placeholder="Confirm new password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" type="button" data-dismiss="modal">Cancel</button>
        <button id="confirm-cred-update" class="btn btn-primary" data-dismiss="modal" type="button">Update</button>
      </div>
    </div>
  </div>
</div>

<script>
  function setAddCourseListener() {
    $('.add-course').on('click', function(event) {
      var courseID = $(this).closest('tr').data('id');
      // Enroll in backend
      $.post(
        '/api/enroll',
        { course_to_add: courseID }
      ).done(function(res) {
        // on successful adding, move table row to enrolled table
        $recommended = $('tr[data-id="' + courseID + '"]');
        $recommended.fadeOut(function() {
          $dropButton = $('<div>', {
            'class': 'btn btn-small btn-danger pull-right drop-button',
            'data-toggle': 'modal'
          }).text('Drop course');
          $recommended.find('.add-course').replaceWith($dropButton);
          $recommended.appendTo('.enrolled-courses');
          $recommended.fadeIn();
        });
      });
    });
  }

  $(function() {
    var dropCourseID;
    // Allows dropping courses
    $('.enrolled-courses').on('click', '.drop-button', function(event) {
      event.preventDefault();
      var courseID = $(this).closest('tr').data('id');
      dropCourseID = courseID;
      $('#dropCourse').modal('show');
    });

    $('#confirmDrop').on('click', function(event) {
      $('#dropCourse').modal('hide');
      $.post(
        "/api/drop",
        { course_to_drop: dropCourseID }
      ).done(function(res) {
        $('[data-id="' + dropCourseID + '"]').remove();
      });
    });

    setAddCourseListener();
  });
</script>
{% endblock %}
